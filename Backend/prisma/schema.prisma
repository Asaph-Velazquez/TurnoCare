generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Hospital {
  hospitalId Int    @id @default(autoincrement())
  nombre     String @db.VarChar(100)
  direccion  String? @db.VarChar(150)
  telefono   String? @db.VarChar(20)
  
  // Relaciones
  servicios  Servicio[]
  
  @@map("hospital")
}

model Servicio {
  servicioId       Int     @id @default(autoincrement())
  nombre          String  @db.VarChar(100)
  descripcion     String?
  capacidadMaxima Int?
  personalAsignado Int    @default(0)
  hospitalId      Int
  
  // Relaciones
  hospital        Hospital @relation(fields: [hospitalId], references: [hospitalId], onDelete: Cascade)
  enfermeros      Enfermero[]
  pacientes       Paciente[]
  urgencias       Urgencias?
  
  @@map("servicio")
}

model Urgencias {
  urgenciaId           Int @id @default(autoincrement())
  nivelTriaje         String? @db.VarChar(50)
  tiempoEsperaPromedio Int?
  servicioId          Int @unique
  
  // Relaciones
  servicio            Servicio @relation(fields: [servicioId], references: [servicioId], onDelete: Cascade)
  
  @@map("urgencias")
}

model Turno {
  turnoId    Int      @id @default(autoincrement())
  nombre     String   @db.VarChar(50)
  horaInicio DateTime @db.Time
  horaFin    DateTime @db.Time
  fecha      DateTime? @db.Date
  
  // Relaciones
  enfermeros Enfermero[]
  
  @@map("turno")
}

model Enfermero {
  enfermeroId      Int     @id @default(autoincrement())
  nombre           String  @db.VarChar(50)
  apellidoPaterno  String  @db.VarChar(100)
  apellidoMaterno  String  @db.VarChar(100)
  numeroEmpleado   String  @unique @db.VarChar(20)
  especialidad     String? @db.VarChar(100)
  esCoordinador    Boolean @default(false)
  turnoAsignadoId  Int?
  servicioActualId Int?
  
  // Relaciones
  turno            Turno? @relation(fields: [turnoAsignadoId], references: [turnoId], onDelete: SetNull)
  servicio         Servicio? @relation(fields: [servicioActualId], references: [servicioId], onDelete: SetNull)
  registrosMedicos RegistroMedico[]
  medicamentos     Medicamentos[]
  inventarios      InventarioMedicamentos[]
  capacitaciones   EnfermeroCapacitacion[]
  
  @@map("enfermero")
}

model Paciente {
  pacienteId       Int      @id @default(autoincrement())
  apellido         String   @db.VarChar(100)
  nombre           String   @db.VarChar(100)
  numeroExpediente String   @unique @db.VarChar(20)
  edad             Int?
  numeroCama       String?  @db.VarChar(10)
  numeroHabitacion String?  @db.VarChar(10)
  fechaIngreso     DateTime @default(now())
  motivoConsulta   String?
  servicioId       Int?
  
  // Relaciones
  servicio         Servicio? @relation(fields: [servicioId], references: [servicioId], onDelete: SetNull)
  registrosMedicos RegistroMedico[]
  
  @@map("paciente")
}

model RegistroMedico {
  registroId     Int      @id @default(autoincrement())
  pacienteId     Int
  enfermeroId    Int
  fechaHora      DateTime @default(now())
  signosVitales  Json?
  observaciones  String?
  
  // Relaciones
  paciente       Paciente @relation(fields: [pacienteId], references: [pacienteId], onDelete: Cascade)
  enfermero      Enfermero @relation(fields: [enfermeroId], references: [enfermeroId], onDelete: Restrict)
  medicamentos   Medicamentos[]
  
  @@map("registromedico")
}

model Medicamentos {
  medicamentoId            Int      @id @default(autoincrement())
  nombre                   String   @db.VarChar(100)
  dosis                    String?  @db.VarChar(50)
  viaAdministracion        String?  @db.VarChar(50)
  frecuencia               String?  @db.VarChar(50)
  fechaHoraAdministracion  DateTime?
  registroMedicoId         Int
  enfermeroResponsable     Int
  
  // Relaciones
  registroMedico           RegistroMedico @relation(fields: [registroMedicoId], references: [registroId], onDelete: Cascade)
  enfermero                Enfermero @relation(fields: [enfermeroResponsable], references: [enfermeroId], onDelete: Restrict)
  
  @@map("medicamentos")
}

model InventarioMedicamentos {
  inventarioId            Int    @id @default(autoincrement())
  medicamentosDisponibles Json
  ubicacionAlmacen        String?
  responsableId           Int
  
  // Relaciones
  responsable             Enfermero @relation(fields: [responsableId], references: [enfermeroId], onDelete: Restrict)
  
  @@map("inventariomedicamentos")
}

model Capacitacion {
  capacitacionId    Int      @id @default(autoincrement())
  titulo            String   @db.VarChar(100)
  descripcion       String?
  fechaImparticion  DateTime?
  duracion          Int?
  instructor        String?  @db.VarChar(100)
  
  // Relaciones
  enfermeros        EnfermeroCapacitacion[]
  
  @@map("capacitacion")
}

model EnfermeroCapacitacion {
  enfermeroId       Int
  capacitacionId    Int
  asistio           Boolean  @default(false)
  fechaInscripcion  DateTime @default(now())
  
  // Relaciones
  enfermero         Enfermero @relation(fields: [enfermeroId], references: [enfermeroId], onDelete: Cascade)
  capacitacion      Capacitacion @relation(fields: [capacitacionId], references: [capacitacionId], onDelete: Cascade)
  
  @@id([enfermeroId, capacitacionId])
  @@map("enfermero_capacitacion")
}